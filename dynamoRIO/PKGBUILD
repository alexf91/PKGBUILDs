# Maintainer: Alexander Fasching <fasching.a91@gmail.com>

pkgname=dynamorio-git
pkgver=7.0.17721.r0.gd224ab16
pkgrel=1
pkgdesc="A dynamic binary instrumentation framework"
url="http://dynamorio.org"
arch=('x86_64' 'i686')
license=('BSD')
depends=()
optdepends=()
makedepends=()
conflicts=()
replaces=()
backup=()
source=("${pkgname}::git+https://github.com/DynamoRIO/dynamorio.git")
sha256sums=('SKIP')

pkgver() {
  cd "$pkgname"
  git describe --long --tags | sed 's/^cronbuild-//;s/\([^-]*-g\)/r\1/;s/-/./g'
}

build() {
  cd "${srcdir}/${pkgname}"
  mkdir build
  cd build
  cmake -DCMAKE_BUILD_TYPE=Release -DDISABLE_WARNINGS=ON ..
  make package
}

package() {
  mkdir -p "${pkgdir}/opt/dynamicrio"
  cd "${pkgdir}/opt/dynamicrio"

  tar xf $(ls "${srcdir}/${pkgname}"/build/DynamoRIO-*.tar.gz) --strip 1
}
